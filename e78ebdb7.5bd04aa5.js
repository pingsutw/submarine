(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{119:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return l})),t.d(n,"toc",(function(){return s})),t.d(n,"default",(function(){return b}));var r=t(3),a=t(7),o=(t(0),t(129)),i={title:"Deploy Submarine On K8s"},l={unversionedId:"adminDocs/k8s/helm",id:"adminDocs/k8s/helm",isDocsHomePage:!1,title:"Deploy Submarine On K8s",description:"\x3c!--",source:"@site/docs/adminDocs/k8s/helm.md",slug:"/adminDocs/k8s/helm",permalink:"/docs/adminDocs/k8s/helm",editUrl:"https://github.com/apache/submarine/edit/master/docs/docs/adminDocs/k8s/helm.md",version:"current",sidebar:"docs",previous:{title:"Setup a Kubernetes cluster using Kind",permalink:"/docs/adminDocs/k8s/kind"},next:{title:"Running Submarine on YARN",permalink:"/docs/adminDocs/yarn/README"}},s=[{value:"Deploy Submarine Using Helm Chart (Recommended)",id:"deploy-submarine-using-helm-chart-recommended",children:[{value:"Install Helm",id:"install-helm",children:[]},{value:"Install Submarine",id:"install-submarine",children:[]},{value:"Access to Submarine Server",id:"access-to-submarine-server",children:[]},{value:"Uninstall Submarine",id:"uninstall-submarine",children:[]}]}],c={toc:s};function b(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},c,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"deploy-submarine-using-helm-chart-recommended"},"Deploy Submarine Using Helm Chart (Recommended)"),Object(o.b)("p",null,"Submarine's Helm Chart will deploy Submarine Server, TF/PyTorch Operator, Notebook controller\nand Traefik. We use the TF/PyTorch operator to run tf/pytorch job, the notebook controller to\nmanage jupyter notebook and Traefik as reverse-proxy."),Object(o.b)("h3",{id:"install-helm"},"Install Helm"),Object(o.b)("p",null,"Helm v3 is minimum requirement.\nSee here for installation: ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://helm.sh/docs/intro/install/"}),"https://helm.sh/docs/intro/install/")),Object(o.b)("h3",{id:"install-submarine"},"Install Submarine"),Object(o.b)("p",null,"The Submarine helm charts is released with the source code for now.\nPlease go to ",Object(o.b)("inlineCode",{parentName:"p"},"http://submarine.apache.org/download.html")," to download"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Install Helm charts from source code")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"cd <PathTo>/submarine\nhelm install submarine ./helm-charts/submarine\n")),Object(o.b)("p",null,'This will install submarine in the "default" namespace.\nThe images are from Docker hub ',Object(o.b)("inlineCode",{parentName:"p"},"apache/submarine"),". See ",Object(o.b)("inlineCode",{parentName:"p"},"./helm-charts/submarine/values.yaml")," for more details"),Object(o.b)("p",null,'If we\'d like use a different namespace like "submarine"'),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"kubectl create namespace submarine\nhelm install submarine ./helm-charts/submarine -n submarine\n")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Note that if you encounter below issue when installation:"),Object(o.b)("pre",{parentName:"blockquote"},Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"Error: rendered manifests contain a resource that already exists.\nUnable to continue with install: existing resource conflict: namespace: , name: podgroups.scheduling.incubator.k8s.io, existing_kind: apiextensions.k8s.io/v1beta1, Kind=CustomResourceDefinition, new_kind: apiextensions.k8s.io/v1beta1, Kind=CustomResourceDefinition\n")),Object(o.b)("p",{parentName:"blockquote"},"It might be caused by the previous installed submarine charts. Fix it by running:"),Object(o.b)("pre",{parentName:"blockquote"},Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"kubectl delete crd/tfjobs.kubeflow.org && kubectl delete crd/podgroups.scheduling.incubator.k8s.io && kubectl delete crd/pytorchjobs.kubeflow.org\n"))),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Verify installation")),Object(o.b)("p",null,"Once you got it installed, check with below commands and you should see similar outputs:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"kubectl get pods\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"NAME                                              READY   STATUS    RESTARTS   AGE\nnotebook-controller-deployment-5db8b6cbf7-k65jm   1/1     Running   0          5s\npytorch-operator-7ff5d96d59-gx7f5                 1/1     Running   0          5s\nsubmarine-database-8d95d74f7-ntvqp                1/1     Running   0          5s\nsubmarine-server-b6cd4787b-7bvr7                  1/1     Running   0          5s\nsubmarine-traefik-9bb6f8577-66sx6                 1/1     Running   0          5s\ntf-job-operator-7844656dd-lfgmd                   1/1     Running   0          5s\n")),Object(o.b)("h3",{id:"access-to-submarine-server"},"Access to Submarine Server"),Object(o.b)("p",null,"Submarine server by default expose 8080 port within K8s cluster. After Submarine v0.5\nuses Traefik as reverse-proxy by default. If you don't want to\nuse Traefik, you can modify below value to ",Object(o.b)("strong",{parentName:"p"},Object(o.b)("em",{parentName:"strong"},"false"))," in ",Object(o.b)("inlineCode",{parentName:"p"},"./helm-charts/submarine/values.yaml"),"."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),"# Use Traefik by default\ntraefik:\n  enabled: true\n")),Object(o.b)("p",null,"To access the server from outside of the cluster, we use Traefik ingress controller and\nNodePort for external access.\\\nPlease refer to ",Object(o.b)("inlineCode",{parentName:"p"},"./helm-charts/submarine/charts/traefik/values.yaml")," and ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://docs.traefik.io/"}),"Traefik docs"),"\nfor more details if you want to customize the default value for Traefik."),Object(o.b)("p",null,Object(o.b)("em",{parentName:"p"},"Notice:"),"\nIf you use ",Object(o.b)("inlineCode",{parentName:"p"},"kind")," to run local Kubernetes cluster,\nplease refer to this ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://kind.sigs.k8s.io/docs/user/configuration/#extra-port-mappings"}),"docs"),'\nand set the configuration "extraPortMappings" when creating the k8s cluster.'),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"kind: Cluster\napiVersion: kind.x-k8s.io/v1alpha4\nnodes:\n- role: control-plane\n  extraPortMappings:\n  - containerPort: 32080\n    hostPort: [the port you want to access]\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"# Use nodePort and Traefik ingress controller by default.\n# To access the submarine server, open the following URL in your browser.\nhttp://127.0.0.1:32080\n")),Object(o.b)("p",null,"If minikube is installed, use the following command to find the URL to the Submarine server."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"$ minikube service submarine-traefik --url\n")),Object(o.b)("h3",{id:"uninstall-submarine"},"Uninstall Submarine"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"helm delete submarine\n")))}b.isMDXComponent=!0},129:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return d}));var r=t(0),a=t.n(r);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=a.a.createContext({}),b=function(e){var n=a.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},u=function(e){var n=b(e.components);return a.a.createElement(c.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},p=a.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=b(t),p=r,d=u["".concat(i,".").concat(p)]||u[p]||m[p]||o;return t?a.a.createElement(d,l(l({ref:n},c),{},{components:t})):a.a.createElement(d,l({ref:n},c))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=p;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=t[c];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,t)}p.displayName="MDXCreateElement"}}]);